"use strict";(self.webpackChunkModDocCE=self.webpackChunkModDocCE||[]).push([[593],{5258:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>h,contentTitle:()=>l,default:()=>o,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"files/pak","title":"PAK files","description":"PAK files are checksum-verified packages that contain a full filesystem structure inside them - they store all assets for the game. PAK files can be layered on top of each other - the game will first search for res.pak, then res1.pak, then res2.pak (etc.) while loading PAKs - PAKs are incrementally stacked on top of each other during the loading process - conflicts are ignored, and the PAK with the highest priority is used.","source":"@site/docs/files/pak.md","sourceDirName":"files","slug":"/files/pak","permalink":"/ModDocCE/files/pak","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"File Formats","permalink":"/ModDocCE/category/file-formats"},"next":{"title":"HashLink bytecode (and hlboot.dat)","permalink":"/ModDocCE/files/hlboot"}}');var n=r(4848),s=r(8453);const d={sidebar_position:1},l="PAK files",h={},c=[{value:"Format",id:"format",level:2},{value:"File",id:"file",level:3},{value:"Header",id:"header",level:3},{value:"Entry",id:"entry",level:3},{value:"DATA marker",id:"data-marker",level:3},{value:"Stamps",id:"stamps",level:2}];function a(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"pak-files",children:"PAK files"})}),"\n",(0,n.jsxs)(t.p,{children:["PAK files are checksum-verified packages that contain a full filesystem structure inside them - they store all assets for the game. PAK files can be layered on top of each other - the game will first search for ",(0,n.jsx)(t.code,{children:"res.pak"}),", then ",(0,n.jsx)(t.code,{children:"res1.pak"}),", then ",(0,n.jsx)(t.code,{children:"res2.pak"})," (etc.) while loading PAKs - PAKs are incrementally stacked on top of each other during the loading process - conflicts are ignored, and the PAK with the highest priority is used."]}),"\n",(0,n.jsx)(t.h2,{id:"format",children:"Format"}),"\n",(0,n.jsx)(t.admonition,{type:"tip",children:(0,n.jsxs)(t.p,{children:["If you're a REHex user, you can download a fully commented out example PAK file from ",(0,n.jsx)(t.a,{href:"https://n3rdl0rd.github.io/alivecells/stamptool/example.pak.zip",children:"here"})]})}),"\n",(0,n.jsx)(t.h3,{id:"file",children:"File"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Size (bytes)"}),(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Struct"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Variable"}),(0,n.jsx)(t.td,{children:"Header"}),(0,n.jsx)(t.td,{children:"File magic, version, data sizes, stamp"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"#header",children:"Header"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Variable"}),(0,n.jsx)(t.td,{children:"Root directory"}),(0,n.jsx)(t.td,{children:"Main directory entry, contains all data in the PAK"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"#entry",children:"Entry"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"DATA marker"}),(0,n.jsx)(t.td,{children:"Marks the start of file content data"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"#data-marker",children:"DATA marker"})})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Variable"}),(0,n.jsx)(t.td,{children:"File contents"}),(0,n.jsx)(t.td,{children:"Actual file data for all files in the PAK"}),(0,n.jsx)(t.td,{children:"Raw binary data"})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"header",children:"Header"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Size (bytes)"}),(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Struct"}),(0,n.jsx)(t.th,{children:"Condition"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"3"}),(0,n.jsx)(t.td,{children:"Magic"}),(0,n.jsx)(t.td,{children:'"PAK"'}),(0,n.jsx)(t.td,{children:"ASCII-encoded text"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"Version"}),(0,n.jsx)(t.td,{children:"0x00 or 0x01 - v0 doesn't support stamping, v1 does"}),(0,n.jsx)(t.td,{children:"Unsigned byte"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Header size"}),(0,n.jsx)(t.td,{children:"Size of the header - at v0, guaranteed to be >16, at v1, guaranteed to be >80"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Data size"}),(0,n.jsx)(t.td,{children:"Size of the data"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"64"}),(0,n.jsx)(t.td,{children:"Stamp"}),(0,n.jsxs)(t.td,{children:["Signature based on git commit - see ",(0,n.jsx)(t.a,{href:"#stamps",children:"here"})]}),(0,n.jsx)(t.td,{children:"ASCII-encoded text"}),(0,n.jsx)(t.td,{children:"Game >=v35, PAK >=v1"})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"entry",children:"Entry"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Size (bytes)"}),(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Struct"}),(0,n.jsx)(t.th,{children:"Condition"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"Name length"}),(0,n.jsx)(t.td,{children:"Length of the entry name"}),(0,n.jsx)(t.td,{children:"Unsigned byte"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Variable"}),(0,n.jsx)(t.td,{children:"Name"}),(0,n.jsx)(t.td,{children:"Name of the entry"}),(0,n.jsx)(t.td,{children:"ASCII-encoded text"}),(0,n.jsx)(t.td,{children:"Name length > 0"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"1"}),(0,n.jsx)(t.td,{children:"Type"}),(0,n.jsx)(t.td,{children:"0x00 for file, 0x01 for directory"}),(0,n.jsx)(t.td,{children:"Unsigned byte"}),(0,n.jsx)(t.td,{children:"None"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Entry count"}),(0,n.jsx)(t.td,{children:"Number of entries in the directory"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"Type == 0x01 (Directory)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"Variable"}),(0,n.jsx)(t.td,{children:"Entries"}),(0,n.jsx)(t.td,{children:"Recursive Entry structures for directory contents"}),(0,n.jsx)(t.td,{children:(0,n.jsx)(t.a,{href:"#entry",children:"Entry"})}),(0,n.jsx)(t.td,{children:"Type == 0x01 (Directory)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Position"}),(0,n.jsx)(t.td,{children:"Offset of the file data from the start of the data section"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"Type == 0x00 (File)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Size"}),(0,n.jsx)(t.td,{children:"Size of the file data in bytes"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"Type == 0x00 (File)"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Checksum"}),(0,n.jsx)(t.td,{children:"Adler32 checksum of the file data"}),(0,n.jsx)(t.td,{children:"Signed 32-bit int"}),(0,n.jsx)(t.td,{children:"Type == 0x00 (File)"})]})]})]}),"\n",(0,n.jsx)(t.h3,{id:"data-marker",children:"DATA marker"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Size (bytes)"}),(0,n.jsx)(t.th,{children:"Name"}),(0,n.jsx)(t.th,{children:"Description"}),(0,n.jsx)(t.th,{children:"Struct"})]})}),(0,n.jsx)(t.tbody,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"4"}),(0,n.jsx)(t.td,{children:"Marker"}),(0,n.jsx)(t.td,{children:'ASCII "DATA" to mark start of content'}),(0,n.jsx)(t.td,{children:"ASCII-encoded text"})]})})]}),"\n",(0,n.jsx)(t.p,{children:"The DATA marker serves as a separator between the header/directory information and the actual file contents. It helps in clearly delineating the structure of the PAK file and can be used as a reference point when reading or writing PAK files."}),"\n",(0,n.jsx)(t.h2,{id:"stamps",children:"Stamps"}),"\n",(0,n.jsx)(t.p,{children:'In v35+ of the game (v1 of the PAK format), PAK files now include "stamps". A stamp is a 64-character (ASCII) digest of a SHA256 hash, generated with this formula (written in pseudocode):'}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-txt",children:'ASCII digest(\n    SHA256(\n        UTF-8 encode("Dc02&0hQC#G0:"),\n        UTF-8 encode(Current git commit - short hash)\n    )\n)\n'})}),"\n",(0,n.jsxs)(t.p,{children:["Due to the deterministic nature of SHA256 and the short length of the commit hash, it is possible to easily brute-force the short hash from a given stamp - an implementation of this exists in Alive Cells' ",(0,n.jsx)(t.a,{href:"https://github.com/N3rdL0rd/alivecells/blob/main/alivecells.py",children:"main script"}),", as the ",(0,n.jsx)(t.code,{children:"commitbrute"})," subcommand. You can also calculate or extract a stamp from a PAK file or from a short hash using the online ",(0,n.jsx)(t.a,{href:"https://n3rdl0rd.github.io/alivecells/stamptool/",children:"stamp calculator"}),"."]})]})}function o(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>d,x:()=>l});var i=r(6540);const n={},s=i.createContext(n);function d(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);